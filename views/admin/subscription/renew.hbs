<!-- ======= Sidebar ======= -->
<aside id="sidebar" class="sidebar">

  <ul class="sidebar-nav" id="sidebar-nav">

    <li class="nav-item">
      <a class="nav-link collapsed" href="/admin/home">
        <i class="bi bi-grid"></i>
        <span>Dashboard</span>
      </a>
    </li>

    <li class="nav-item">
      <a class="nav-link collapsed" href="/admin/attendance">
        <i class="bi bi-person-check"></i>
        <span>Attendance</span>
      </a>
    </li>

    <li class="nav-item">
      <a class="nav-link collapsed" data-bs-target="#forms-nav" data-bs-toggle="collapse" href="#">
        <i class="bi bi-journal-text"></i><span>Customer</span><i class="bi bi-chevron-down ms-auto"></i>
      </a>
      <ul id="forms-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <li>
          <a href="/admin/customer/add">
            <i class="bi bi-circle"></i><span>Add Customer</span>
          </a>
        </li>
        <li>
          <a href="/admin/customer/table">
            <i class="bi bi-circle"></i><span>List Customer</span>
          </a>
        </li>
        <li>
          <a href="/admin/customer/update">
            <i class="bi bi-circle"></i><span>Update Customer</span>
          </a>
        </li>

        <li>
          <a href="/admin/customer/payments">
            <i class="bi bi-circle"></i><span>Payments</span>
          </a>
        </li>
      </ul>
    </li>

    <li class="nav-item">
      <a class="nav-link collapsed" data-bs-target="#guest-nav" data-bs-toggle="collapse" href="#">
        <i class="bi bi-ubuntu"></i><span>Guest</span><i class="bi bi-chevron-down  ms-auto"></i>
      </a>
      <ul id="guest-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
        <li>
          <a href="/admin/guest/add">
            <i class="bi bi-circle"></i><span>Add Guest</span>
          </a>
        </li>
        <li>
          <a href="/admin/guest/table">
            <i class="bi bi-circle"></i><span>List Guest</span>
          </a>
        </li>
      </ul>
    </li>

    <li class="nav-item">
      <a class="nav-link collapsed" data-bs-target="#sub-nav" data-bs-toggle="collapse" href="#">
        <i class='bx bxs-wallet-alt'></i><span>Subscription</span><i class="bi bi-chevron-down  ms-auto"></i>
      </a>
      <ul id="sub-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
        <li>
          <a href="/admin/subscription/show">
            <i class="bi bi-circle"></i><span>Show subscription</span>
          </a>
        </li>
        <li>
          <a href="/admin/subscription/renew" class="active">
            <i class="bi bi-circle"></i><span>Renew subscription</span>
          </a>
        </li>
        <li>
          <a href="/admin/subscription/status">
            <i class="bi bi-circle"></i><span>Change Status</span>
          </a>
        </li>
      </ul>
    </li><!-- End Dashboard Nav -->
    <li class="nav-item">
      <a class="nav-link collapsed" href="/admin/reports">
        <i class='bx bxs-report'></i>
        <span>Reports</span>
      </a>
    </li><!-- End Dashboard Nav -->
  </ul>

</aside>
<!-- End Sidebar-->

<main class="main" id="main">
  <div class="pagetitle">
    <h1>Subscription</h1>
  </div><!-- End Page Title -->

  <form method="post" action="/admin/subscription/renew/update">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Renew Subscription</h5>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">UG number</label>
          <input class="col-sm-5 col-form-label border-0" name="ugnumber" value="{{data.ug_number}}" readonly />
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Name</label>
          <label class="col-sm-5 col-form-label border-0">{{data.first_name}} {{data.last_name}}</label>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">last Renew Date</label>
          <div class="col-sm-5 col-form-label">{{data.Subscription.renew_date}}</div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Mess Plan</label>
          <div class="col-sm-5">
            <div class="input-group">
              <input type="number" name="messPlan" class="form-control" value="{{data.Subscription.number_of_days}}" />
              <div class="input-group-text">days</div>
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Mess Type</label>
          <div class="col-sm-5">
            <select name="messType" id="messType" class="form-select">
              <option value="both" {{#if data.Subscription.typeBoth}} selected {{/if}}>both times</option>
              <option value="single" {{#if data.Subscription.typeSingle}} selected {{/if}}>single time</option>
            </select>
          </div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Status</label>
          <div class="col-sm-5">
            <select class="form-select" name="status" aria-label="Default select example">
              <option value="active" {{#if data.Subscription.statusActive}} selected {{/if}}>Active</option>
              <option value="inavtive" {{#if data.Subscription.statusInActive}} selected {{/if}}>In-Active</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Payment</h5>
        <div class="row mb-3">
          <label for="billNumber" class="col-sm-2 col-form-label">Bill Number</label>
          <div class="col-sm-5">
            <div class="input-group">
              <input type="number" class="form-control" placeholder="Bill Number" id="billNumber" name="billNumber"
                value="" required />
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <label for="payamount" class="col-sm-2 col-form-label">Total Amount</label>
          <div class="col-sm-5">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-currency-rupee"></i></span>
              <input type="number" class="form-control" placeholder="Amount" id="payamount" name="totalAmount"
                value="2400" required />
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <label for="remaningAmount" class="col-sm-2 col-form-label">Paid Amount</label>
          <div class="col-sm-5">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-currency-rupee"></i></span>
              <input type="number" class="form-control" placeholder="Paid Amount" id="paidAmount" name="paidAmount"
                value="2400" required />
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="paymode">Pay Mode</label>

          <div class="col-sm-5" id="paymentOptionsWrapper">
            <div class="row mb-3">
              <div class="col-sm-2 input-group">
                <span class="input-group-text">Cash&nbsp;&nbsp;</span>
                <input type="number" class="form-control" id="cash" name="cash" value="0">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-sm-2 input-group">
                <span class="input-group-text">online</span>
                <input type="number" class="form-control" id="online" name="online" value="0">
              </div>
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <label for="remaningAmount" class="col-sm-2 col-form-label">Remaning Amount</label>
          <div class="col-sm-5">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-currency-rupee"></i></span>
              <input type="number" class="form-control" placeholder="Remaning Amount" id="remaningAmount"
                name="remaningAmount" value="0" readonly />
            </div>
          </div>
        </div>


        <div class="row mb-3" id="txnrow">
          <label class="col-sm-2 col-form-label" for="txnid">Txn ID</label>
          <div class="col-sm-5">
            <input type="text" class="form-control" placeholder="Transaction ID" id="txnid" name="txnid" required
              disabled>
          </div>
        </div>

        <div class="row mb-3">
          <label for="payDate" class="col-sm-2 col-form-label">Pay Date</label>
          <div class="col-sm-5">
            <input type="date" class="form-control" name="payDate" id="paydate" required />
          </div>
          <script type="module">

            const payDate = document.querySelector('input[id=paydate]');
            const d = new Date().toISOString().split(':')[0].slice(0, 10);
            payDate.defaultValue = d;
            payDate.setAttribute('max', d);

          </script>
        </div>

        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Submit Button</label>
          <div class="col-sm-5">
            <button type="submit" class="btn btn-primary" id='submitBtn'>Submit Form</button>
          </div>
        </div>
      </div>
    </div>
    <input type="date" name="date" id="date" class="d-none" />
  </form>
</main>
<script type="module">
  import { DateTime } from 'https://cdn.jsdelivr.net/npm/luxon@3.2.1/+esm';
  const paidAmount = document.querySelector('#paidAmount');
  const remaningAmount = document.querySelector('#remaningAmount');
  const payAmount = document.querySelector('#payamount');
  const date = document.querySelector('input[name=date]');

  date.value = DateTime.now().toISODate();
  console.log(date.value);
  payamount.addEventListener('input', (ev) => {
    paidAmount.value = payAmount.value;
    remaningAmount.value = 0;
  });

  [paidAmount, remaningAmount].forEach(ele => {
    ele.addEventListener('input', (ev) => {

      const total = Number.parseFloat(payAmount.value);
      let paid = Number.parseFloat(paidAmount.value);
      let remaning = Number.parseFloat(remaningAmount.value);

      if (paid > total) {
        paid = total;
      }

      if (paid < 0) {
        paid = 0;
      }

      if (remaning < 0) {
        remaning = 0;
        paid = total;
      }

      remaning = total - paid;

      paidAmount.value = paid;
      remaningAmount.value = remaning;
    });
  });
</script>
